---
const NAV = [
  { href: "/#services", label: "Services" },
  { href: "/#careers", label: "Careers" },
  { href: "/#mission-configurator", label: "Mission Configurator" },
  { href: "/contact", label: "Contact" },
];
---

<header class="sticky top-0 z-50 bg-white">
  <div class="relative flex items-center px-8 h-18">
    <div class="invisible flex-1"></div>

    <nav
      class="
        hidden md:flex items-center
        [gap:clamp(36px,18vw,216px)]
      "
    >
      {NAV.map((i) => (
        <a
          href={i.href}
          data-transition
          class="
            flex items-center font-semibold text-black hover:text-black
            [font-size:clamp(13px,1.1vw,13px)]
            [letter-spacing:clamp(-0.02em,-0.01vw,0em)]
            whitespace-nowrap
          "
        >
          {i.label}
        </a>
      ))}
    </nav>

    <div class="invisible flex-1"></div>

    <a
      href="/"
      data-transition
      aria-label="Home"
      class="absolute left-8 top-1/2 transform -translate-y-1/2 inline-flex items-center font-inter font-bold"
    >
      <img src="/trust.svg" alt="Logo" width="48" height="48" class="h-10 w-10" />
    </a>

    <button
      id="menuBtn"
      type="button"
      aria-label="Menu"
      aria-expanded="false"
      class="
        absolute right-8 top-1/2 transform -translate-y-1/2
        inline-flex items-center justify-end font-inter font-bold
        pointer-events-auto
        md:pointer-events-none
      "
    >
      <svg viewBox="0 0 48 48" width="48" height="48" aria-hidden="true">
        <path
          d="M0 24H48M0 32H48"
          stroke="black"
          stroke-width="1.5"
          stroke-linecap="square"
        />
      </svg>
    </button>
  </div>

  <div
    id="mobileMenu"
    class="fixed inset-0 z-[60] hidden bg-white md:hidden"
    role="dialog"
    aria-modal="true"
    aria-label="Mobile navigation"
  >
    <div class="relative h-full w-full px-8">
      <div class="h-18"></div>

      <nav class="flex h-[calc(100%-72px)] flex-col items-center justify-center text-center">
        <div class="flex flex-col gap-3">
          {NAV.map((i) => (
            <a href={i.href} data-transition class="text-4xl font-bold leading-tight">
              {i.label}
            </a>
          ))}
        </div>
      </nav>
    </div>
  </div>

  <script is:inline>
    const btn = document.getElementById("menuBtn");
    const menu = document.getElementById("mobileMenu");

    const isMobile = () => window.matchMedia("(max-width: 1600px)").matches;

    const openMenu = () => {
      menu?.classList.remove("hidden");
      btn?.setAttribute("aria-expanded", "true");
      document.documentElement.style.overflow = "hidden";
    };

    const closeMenu = () => {
      menu?.classList.add("hidden");
      btn?.setAttribute("aria-expanded", "false");
      document.documentElement.style.overflow = "";
    };

    btn?.addEventListener("click", () => {
      if (!isMobile()) return;
      if (menu?.classList.contains("hidden")) openMenu();
      else closeMenu();
    });

    menu?.addEventListener("click", (e) => {
      const a = e.target?.closest?.("a");
      if (a) closeMenu();
    });

    window.addEventListener("keydown", (e) => {
      if (e.key === "Escape") closeMenu();
    });

    window.addEventListener("resize", () => {
      if (!isMobile()) closeMenu();
    });

    // ---- Transition-aware navigation ----
    const isSamePageHashOnly = (href) => href && href.startsWith("#");

    const isExternal = (href) => {
      try {
        const u = new URL(href, window.location.href);
        return u.origin !== window.location.origin;
      } catch {
        return false;
      }
    };

    document.addEventListener("click", (e) => {
      const a = e.target?.closest?.("a[data-transition]");
      if (!a) return;

      if (e.metaKey || e.ctrlKey || e.shiftKey || e.altKey) return;
      if (a.target === "_blank") return;

      const href = a.getAttribute("href");
      if (!href) return;

      // only skip animation for SAME-PAGE anchor jumps like "#careers"
      if (isSamePageHashOnly(href)) return;

      if (isExternal(href)) return;

      e.preventDefault();

      if (typeof window.__coverThenNavigate === "function") {
        window.__coverThenNavigate(href);
      } else {
        window.location.href = href;
      }
    });
  </script>

</header>
