---
const NAV = [
  { href: "/#platform", label: "Platform" },
  { href: "/#company", label: "Company" },
  { href: "/#newsletters", label: "Newsletters" },
  { href: "/contact", label: "Contact" },
];
---

<header class="sticky top-0 z-50 bg-white">
  <div class="relative flex items-center px-8 h-18">
    <div class="invisible flex-1"></div>

    <nav
      class="hidden md:flex items-center
        [gap:clamp(36px,18vw,216px)]"
    >
      {
        NAV.map((i) => (
          <a
            href={i.href}
            data-transition
            class="
            flex items-center font-semibold text-black hover:text-black
            [font-size:clamp(13px,1.1vw,13px)]
            [letter-spacing:clamp(-0.02em,-0.01vw,0em)]
            whitespace-nowrap
          "
          >
            {i.label}
          </a>
        ))
      }
    </nav>

    <div class="invisible flex-1"></div>

    <a
      href="/"
      data-transition
      aria-label="Home"
      class="absolute left-8 top-1/2 transform -translate-y-1/2 inline-flex items-center font-inter font-bold logo-link"
    >
      <span class="logo-swap" aria-hidden="true">
        <img
          src="/trust.svg"
          alt="Logo"
          width="48"
          height="48"
          class="logo-img logo-img--base"
        />
        <img
          src="/trust.svg"
          alt=""
          width="48"
          height="48"
          class="logo-img logo-img--hover"
          aria-hidden="true"
        />
      </span>
    </a>

    <button
      id="menuBtn"
      type="button"
      aria-label="Menu"
      aria-expanded="false"
      class="absolute right-8 top-1/2 transform -translate-y-1/2
        inline-flex items-center justify-end font-inter font-bold
        pointer-events-auto
        md:pointer-events-none"
    >
      <svg viewBox="0 0 48 48" width="48" height="48" aria-hidden="true">
        <path
          d="M0 24H48M0 32H48"
          stroke="black"
          stroke-width="1.5"
          stroke-linecap="square"></path>
      </svg>
    </button>
  </div>

  <div
    id="mobileMenu"
    class="fixed inset-0 z-[60] bg-white md:hidden mobile-menu"
    role="dialog"
    aria-modal="true"
    aria-label="Mobile navigation"
  >
    <div class="relative h-full w-full px-8">
      <div class="h-18"></div>

      <nav
        class="flex h-[calc(100%-72px)] flex-col items-center justify-center text-center"
      >
        <div class="flex flex-col gap-3">
          {
            NAV.map((i) => (
              <a
                href={i.href}
                data-transition
                class="text-4xl font-bold leading-tight"
              >
                {i.label}
              </a>
            ))
          }
        </div>
      </nav>
    </div>
  </div>

  <style>
    .mobile-menu {
      opacity: 0;
      transform: translate3d(0, -16px, 0);
      pointer-events: none;
      visibility: hidden;
      transition:
        opacity 280ms ease,
        transform 320ms ease,
        visibility 0ms linear 320ms;
    }

    .mobile-menu.is-open {
      opacity: 1;
      transform: translate3d(0, 0, 0);
      pointer-events: auto;
      visibility: visible;
      transition:
        opacity 280ms ease,
        transform 320ms ease;
    }

    .logo-swap {
      position: relative;
      display: block;
      width: 40px;
      height: 40px;
      overflow: hidden;
    }

    .logo-img {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      transition: transform 320ms ease;
    }

    .logo-img--base {
      transform: translateY(0);
    }

    .logo-img--hover {
      filter: brightness(0) saturate(100%);
      opacity: 0;
      mask-image: linear-gradient(to top, black 60%, transparent 100%);
      mask-size: 100% 200%;
      mask-position: 0 100%;
      -webkit-mask-image: linear-gradient(to top, black 60%, transparent 100%);
      -webkit-mask-size: 100% 200%;
      -webkit-mask-position: 0 100%;
      transition:
        opacity 200ms ease,
        mask-position 360ms ease,
        -webkit-mask-position 360ms ease;
    }

    .logo-link:hover .logo-img--hover {
      opacity: 1;
      mask-position: 0 0;
      -webkit-mask-position: 0 0;
    }

    @media (prefers-reduced-motion: reduce) {
      .mobile-menu,
      .mobile-menu.is-open {
        transition: none;
        transform: none;
      }

      .logo-img {
        transition: none;
      }

      .logo-img--hover {
        opacity: 1;
        mask-position: 0 0;
        -webkit-mask-position: 0 0;
      }
    }
  </style>

  <script is:inline>
    const btn = document.getElementById("menuBtn");
    const menu = document.getElementById("mobileMenu");

    const isMobile = () => window.matchMedia("(max-width: 1600px)").matches;


    const openMenu = () => {
      menu?.classList.add("is-open");
      btn?.setAttribute("aria-expanded", "true");
      document.documentElement.style.overflow = "hidden";
    };

    const closeMenu = () => {
      menu?.classList.remove("is-open");
      btn?.setAttribute("aria-expanded", "false");
      document.documentElement.style.overflow = "";
    };

    btn?.addEventListener("click", () => {
      if (!isMobile()) return;
      if (!menu?.classList.contains("is-open")) openMenu();
      else closeMenu();
    });

    menu?.addEventListener("click", (e) => {
      const a = e.target?.closest?.("a");
      if (a) closeMenu();
    });

    window.addEventListener("keydown", (e) => {
      if (e.key === "Escape") closeMenu();
    });

    window.addEventListener("resize", () => {
      if (!isMobile()) closeMenu();
    });

    // ---- Transition-aware navigation ----
    const isSamePageHashOnly = (href) => href && href.startsWith("#");

    const isExternal = (href) => {
      try {
        const u = new URL(href, window.location.href);
        return u.origin !== window.location.origin;
      } catch {
        return false;
      }
    };

    document.addEventListener("click", (e) => {
      const a = e.target?.closest?.("a[data-transition]");
      if (!a) return;

      if (e.metaKey || e.ctrlKey || e.shiftKey || e.altKey) return;
      if (a.target === "_blank") return;

      const href = a.getAttribute("href");
      if (!href) return;

      // only skip animation for SAME-PAGE anchor jumps like "#careers"
      if (isSamePageHashOnly(href)) return;

      if (isExternal(href)) return;

      e.preventDefault();

      if (typeof window.__coverThenNavigate === "function") {
        window.__coverThenNavigate(href);
      } else {
        window.location.href = href;
      }
    });
  </script>
</header>
